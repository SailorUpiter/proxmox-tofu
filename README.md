# Использование провайдера терраформа\тофу для создания виртуальных машин.

## Описание
Шаблон для создания ВМ используя terraform\OpenTofu.
Данный шаблон позволет провести деплой виртуальных машин вместе с установленой ОС Ubuntu 22.04. Для использования требуется провайдер [bpg\proxmox](https://github.com/bpg/terraform-provider-proxmox). Так же присутсвует интеграция с системой [Netbox](https://netboxlabs.com/docs/netbox/)

### Описание рабочего каталога. 
Рабочий каталог содержит файлы:
- netbox.tf
- provider.tf
- template.tf
- ubuntu_cloud_config.tf
- values_tmpl.tfvars
- variables.tf

В файле provider.tf содержится информация об используемых провайдерах т.е. какие функции в апи мы будем использовать для взимодействия с системами.
К сожалению реджистри (хранилище провайдеров) терраформа и опентофу недоступны на территории РФ, поэтому требуется создать файл .tofurc (или .terraformrc) и указать зеркала доступные из РФ. Данный файл требуется положить в домашнюю директорию пользователя, который будет запускать работу OpenTofu
Для подробностей [статья] (https://dev.to/kvendingoldo/kak-nastroit-zierkalo-rieiestrov-dlia-opentofu-i-terraform-277k)

Файл template.tf содержит основные настройки и параметры системы. Исполнение этого файла создает и настраивает ВМ со стороны гипервизора (ЦПУ, диск, RAM и т. д.). Для подробностей смотреть документацию и коментарии.
Файл ubuntu_cloud_config.tf нужен для генераци облачного конфига которые настроит нашу ВМ изнутри (Логин пароль, ssh-ключи и т.д.). Для подробностей смотреть документацию и коментарии.
Файл variables.tf нужен для объявления и настройки переменных. Перед использованием переменной в terraform ее нужно объявить, указать ее тип, описание и значение по умолчанию.
Файл values_tmpl.tf содержит шаблон заполнения значений переменных. Подробнее о переменных и значениях читайте в документации и коментариях.
Файл netbox.tf отвечает за занесение сведений о виртуальной машине в систему учета Netbox

### Требуется создать
Файл настроек зеркала реджистри для провайдера, так как оригинальный реджистри недоступен из РФ. Данный файл создается в домашнем каталоге пользователя, который будет выполнять манифесты.
Имя файла .tofurc (или .terraformrc). 
Файл содержащий значения для объявленных переменных values.tfvars. Данный файл соержит значения для объявленных переменных. Файл содержит чувствительную информацию и не должен храниться в открытом виде. Для облегчения жизни используем файл values_tmpl.tf, он содержит названия всех переменных. Нам нужно только подставить их значения
