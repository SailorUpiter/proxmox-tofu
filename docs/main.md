### Документация для работы с OpenTofu на Proxmox
Для автоматизации развертывания виртуальных машин мы будем использовать OpenTofu.
OpenTofu - это opensource форк Terraform со свободной лицензией. На данный момент они обратно совместимы. Если в какой то момент будет найдено расхождение, то на это будет указано. В данный момент мы можем использовать официальную документацию к terraform для работы с OpenTofu.
Данный инструмент позволяет нам работать с инфратруктурой как с кодом, что позволяет декларативно описывать требуемое состояние ресурсов. Это уменьшает кольичество ошибок при создании ресурсов, а так же помогает в их учете. Так же благодрая API используемых нами сервисов, мы можем сразу же интегрировать созданый нами ресурс в нашу инфраструктуру.
## Принцип работы OpenTofu
Для автоматизации работы с инфраструктурой OpenTofu использует собственный язык написания конфигурационных файлов разработаный Hashicorp Configuration Language (HCL). По сути, этот язык описывает желаемое состояние инфраструктуры в конфигурационном файле (или файлах).
Работа с OpenTofu строится на трёх основных этапах: инициализация, планирование и применение изменений.
# Этап 1: Инициализация проекта
```
tofu init
```
Эта команда производит иницилизацию репозитория проекта, а именно скачивает указанные провайдеры. Если провайдеры уже скачаны, то проверяет новые версии и обновляет их.
# Этап 2: Планирование изменений 
```
tofu plan
```
На этом этапе OpenTofu читает все файлы в директории с расширением .tf и создает общий файл стейта (state) с расширением .tfstate в котором содержится информация о планируемой архитектуре и выделенных ресурсах.
Содержимое данного файла он выводи в консоль. Если файл стейта уже существуе, то OpenTofu читает его и сравнивает с конфигурацией указанной в файлах .tf и выводит дифф (diff) в консоль. Нужно внимательно его изучать для избегания проблем
# Этап 3: Применение изменений 
```
tofu apply
```
Применяет указанные в стейт файле изменения, создавая или изменяя перечисленные ресурсы. Работа с ресурсами идет в асинхронном режим (т. е. паралельно) и может выполняться до 10 задач сразу. 
## Команды для использования данного репозитория
После проведения подготовки и заполнения всех значений требуется выполнить следующие команды.
- tofu init
Мы иницилизируем репозиторий. Скачиваем провайдеры или если они уже скачаны обновляем их.
- tofu plan -var-file values.tfvars -out vm
предварительно читаем конфигурацию из всех .tf файлов. 
опция -var-file указывает на файл с переменными в котором находятся все основные настройки ВМ.
опция -out создает файл в котором хранится вся прочитанная нами конфигурация с уже вставленными значениями переменных. Имя файла конфигурации может быть любым
- tofu apply vm
Мы применяем настройки указанные в файле, который создался после применения tofu plan.
Начинается создание виртуальной машины в зависимости от настроек которые мы указали
